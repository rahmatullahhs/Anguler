<div class="container">
  <h2>{{ isEditMode ? 'Edit COGS Entry' : 'Add New COGS Entry' }}</h2>

  <form [formGroup]="cogsForm" (ngSubmit)="onSubmit()" method="post">

    <div class="col-md-4">
      <label for="date" class="form-label"><i class="fas fa-calendar me-1 text-primary"></i> Date</label>
      <input type="date" class="form-control" id="date" formControlName="date">
    </div>

    <div class="form-group">
      <label>Purchase Invoice</label>
      <input type="text" formControlName="purchaseInvoice" class="form-control" required />
    </div>

    <div class="form-group">
      <label>Product Name</label>
      <input type="text" formControlName="productName" class="form-control" required />
    </div>

    <div class="form-group">
      <label>Product Price</label>
      <input type="number" formControlName="productPrice" class="form-control" required />
    </div>

    <div class="form-group">
      <label>Transport Fee</label>
      <input type="number" formControlName="transportFee" class="form-control" required />
    </div>

    <div class="form-group">
      <label>Labour Cost</label>
      <input type="number" formControlName="labourCost" class="form-control" required />
    </div>

    <div class="form-group">
      <label>Packing Cost</label>
      <input type="number" formControlName="packingCost" class="form-control" required />
    </div>

    <div class="form-group">
      <label>Tax (⬇️ Around ~20.5% of CIF=Cost, Insurance, Freight)</label>
      <input type="number" formControlName="tax" class="form-control" readonly />
    </div>

    <div class="form-group">
      <label>Total COGS</label>
      <input type="number" class="form-control" [value]="calculateTotalCogs()" readonly />
    </div>

    <!-- New Product Quantity Field -->
    <div class="form-group">
      <label>Product Quantity</label>
      <input type="number" formControlName="quantity" class="form-control" required (input)="onQuantityChange()" />
    </div>

    <!-- Calculated Result: Price Per Unit -->
    <div class="form-group">
      <label>Price Per Unit (৳)</label>
      <input type="number" class="form-control" [value]="calculatePricePerUnit()" readonly />
    </div>

    <button type="submit" class="btn btn-primary">{{ isEditMode ? 'Update' : 'Add' }}</button>
    <button type="button" class="btn btn-secondary" (click)="resetForm()">Reset</button>
  </form>

  <hr />

  <h3>COGS Records</h3>
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>Purchase Invoice</th>
        <th>Product Name</th>
        <th>Product Price</th>
        <th>Transport Fee</th>
        <th>Labour Cost</th>
        <th>Packing Cost</th>
        <th>Tax</th>
        <th>Total COGS</th>
        <th>Product Quantity</th>
        <th>Price Per Unit</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let cogs of cogsList">
        <td>{{ cogs.purchaseInvoice }}</td>
        <td>{{ cogs.productName }}</td>
        <td>{{ cogs.productPrice }}</td>
        <td>{{ cogs.transportFee }}</td>
        <td>{{ cogs.labourCost }}</td>
        <td>{{ cogs.packingCost }}</td>
        <td>{{ cogs.tax | number:'1.2-2' }}</td>
        <td>{{ cogs.totalCogs | number:'1.2-2' }}</td>
        <td>{{ cogs.quantity }}</td>
        <td>{{ cogs.productPricePerUnit | number:'1.2-2' }}</td>
        <td>
          <button class="btn btn-sm btn-info" (click)="editCogs(cogs)">Edit</button>
          <button class="btn btn-sm btn-danger" (click)="deleteCogs(cogs.id!)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
