<div class="container mt-4">

  <!-- Shop Info -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <div style="width: 80px; height: 80px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 15px; padding: 8px; box-sizing: border-box;">
          <img src="assets/gt-logo.jpg" alt="Business Icon" style="max-width: 100%; max-height: 100%; object-fit: contain; border: 1px solid black; border-radius: 4px; display: block;" />
        </div>
        <div>
          <h3 class="mb-1" style="color:#513aa3;"><b>Global Tech</b></h3>
          <p class="mb-0" style="font-size:14px; color:#555;">1234 Tech Avenue, Silicon City, CA 94043</p>
          <p class="mb-0" style="font-size:14px; color:#555;">Phone: +1 (555) 123-4567 | Email: info@globaltech.com</p>
          <p class="mb-0" style="font-size:14px; color:#555;">Website: www.globaltech.com</p>
        </div>
      </div>
      <div>
        <h5 class="text-muted">INVOICE</h5>
        <h6 class="fw-bold">#{{ orderForm.value.invoiceNumber || '0000' }}</h6>
      </div>
    </div>
  </div>

  <!-- Invoice Info -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <form [formGroup]="orderForm">
        <div class="row g-3">
          <div class="col-md-4">
            <label for="invoiceNumber" class="form-label fw-semibold">
              <i class="fas fa-file-invoice me-1 text-danger"></i> Invoice No
            </label>
            <input id="invoiceNumber" type="text" class="form-control" formControlName="invoiceNumber" placeholder="Invoice Number">
          </div>

          <div class="col-md-4">
            <label for="date" class="form-label fw-semibold">
              <i class="fas fa-calendar me-1 text-primary"></i> Purchase Date
            </label>
            <input type="date" class="form-control" id="date" formControlName="date">
          </div>

          <div class="col-md-4">
            <label for="creatBy" class="form-label fw-semibold">
              <i class="fas fa-user-edit me-1 text-info"></i> Created By
            </label>
            <input type="text" class="form-control" id="creatBy" formControlName="creatBy" placeholder="Created By">
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Customer Info -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <form [formGroup]="orderForm">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="customerName" class="form-label fw-semibold">
              <i class="fas fa-user me-1"></i> Customer Name
            </label>
            <input id="customerName" type="text" class="form-control" formControlName="customerName" placeholder="Enter full name" required />
          </div>
          <div class="col-md-6">
            <label for="customerEmail" class="form-label fw-semibold">
              <i class="fas fa-envelope me-1"></i> Customer Email Address
            </label>
            <input id="customerEmail" type="email" class="form-control" formControlName="customerEmail" placeholder="example@company.com" required />
          </div>
        </div>

        <div class="row g-3 mt-3">
          <div class="col-md-6">
            <label for="customerPhone" class="form-label fw-semibold">
              <i class="fas fa-phone me-1"></i> Customer Phone Number
            </label>
            <input id="customerPhone" type="tel" class="form-control" formControlName="customerPhone" placeholder="+1 555-0123" required />
          </div>
          <div class="col-md-6">
            <label for="customerAddress" class="form-label fw-semibold">
              <i class="fas fa-map-marker-alt me-1"></i> Customer Address
            </label>
            <input id="customerAddress" type="text" class="form-control" formControlName="customerAddress" placeholder="Enter customer address" required />
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Products Table -->
  <h2 class="mb-3" style="color:#007b5e;">Purchase Summary</h2>

  <table class="table table-striped table-bordered shadow-sm" *ngIf="cartItems.length > 0">
    <thead>
      <tr class="table-success">
        <th>#</th>
        <th>Product Name</th>
        <th>Quantity</th>
        <th>Unit Price</th>
        <th>Total Price</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of cartItems; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ item.product.name }}</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.product.price | currency }}</td>
        <td>{{ (item.product.price * item.quantity) | currency }}</td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="cartItems.length === 0" class="alert alert-warning">Your cart is empty.</div>

  <!-- Totals -->
  <div class="card p-3 shadow-sm mt-4" style="max-width: 400px;">
    <form [formGroup]="orderForm" class="mb-3">
      <div class="mb-2">
        <label for="discount" class="form-label">Discount</label>
        <input id="discount" type="number" class="form-control" formControlName="discount" min="0" />
      </div>

      <div class="mb-2">
        <label for="taxRate" class="form-label">Tax Rate (%)</label>
        <input id="taxRate" type="number" class="form-control" formControlName="taxRate" min="0" />
      </div>

      <div class="mb-2">
        <label for="paid" class="form-label">Amount Paid</label>
        <input id="paid" type="number" class="form-control" formControlName="paid" min="0" />
      </div>
    </form>

    <p><strong>Subtotal:</strong> {{ orderForm.value.subtotal | currency }}</p>
    <p><strong>Tax Amount:</strong> {{ orderForm.value.taxAmount | currency }}</p>
    <p><strong>Total:</strong> {{ orderForm.value.total | currency }}</p>
    <p><strong>Due:</strong> {{ orderForm.value.due | currency }}</p>

    <button class="btn btn-primary w-100 mt-3" (click)="submitOrder()" [disabled]="orderForm.invalid || cartItems.length === 0">Complete Sale</button>
    <button class="btn btn-outline-secondary w-100 mt-2" (click)="printInvoice()" [disabled]="cartItems.length === 0">Print Invoice</button>
  </div>

</div>

<!-- Hidden Invoice Preview for PDF generation -->
<div id="invoiceToPrint" style="display:none; width: 210mm; padding: 20px; background-color: white;">
  <!-- Duplicate the invoice content here for printing -->
  <h1>Invoice Preview</h1>
  <p><strong>Invoice Number:</strong> {{ orderForm.value.invoiceNumber || '0000' }}</p>
  <p><strong>Date:</strong> {{ orderForm.value.date }}</p>
  <p><strong>Customer Name:</strong> {{ orderForm.value.customerName }}</p>
  <p><strong>Customer Email:</strong> {{ orderForm.value.customerEmail }}</p>

  <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
    <thead>
      <tr style="background-color: #eee;">
        <th style="border: 1px solid #ddd; padding: 8px;">#</th>
        <th style="border: 1px solid #ddd; padding: 8px;">Product</th>
        <th style="border: 1px solid #ddd; padding: 8px;">Qty</th>
        <th style="border: 1px solid #ddd; padding: 8px;">Unit Price</th>
        <th style="border: 1px solid #ddd; padding: 8px;">Total</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of cartItems; let i = index">
        <td style="border: 1px solid #ddd; padding: 8px;">{{ i + 1 }}</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{{ item.product.name }}</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{{ item.quantity }}</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{{ item.product.price | currency }}</td>
        <td style="border: 1px solid #ddd; padding: 8px;">{{ (item.product.price * item.quantity) | currency }}</td>
      </tr>
    </tbody>
  </table>

  <p><strong>Subtotal:</strong> {{ orderForm.value.subtotal | currency }}</p>
  <p><strong>Discount:</strong> {{ orderForm.value.discount | currency }}</p>
  <p><strong>Tax Amount:</strong> {{ orderForm.value.taxAmount | currency }}</p>
  <p><strong>Total:</strong> {{ orderForm.value.total | currency }}</p>
  <p><strong>Paid:</strong> {{ orderForm.value.paid | currency }}</p>
  <p><strong>Due:</strong> {{ orderForm.value.due | currency }}</p>
</div>
